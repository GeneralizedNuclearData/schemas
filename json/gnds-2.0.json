{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http:/github.com/generalizednucleardata/schemas/blob/master/json/gnds-2.0.json",
  "type": "object",
  "version": 2.0,
  "title": "GNDS JSON schema",
  "description": "Schema for a GNDS JSON object",
  "properties":{
    "multiplicity": {"$ref": "#/definitions/multiplicity" },
    "reactionSuite": {"$ref": "#/definitions/reactionSuite" },
    "regions1d": {"$ref": "#/definitions/regions1d" },
    "twoBody": {"$ref": "#/definitions/twoBody" }
  },
  "additionalProperties": false,
  "definitions": {
    "angularEnergy": {
      "description": "Angular-energy distribution",
      "type": "object"
    },
    "axes": {
      "description": "Mechanism for providing label an unit for every axis.",
      "type": "array",
      "oneOf": [
        {
          "items": { "$ref": "#/definitions/axis" }
        },
        {
          "items": { "$ref": "#/definitions/grid" }
        }
      ],
      "minItems": 2
    },
    "axis": {
      "description": "label and unit for each axis",
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "attribute": true
        },
        "unit": {
          "type": "string",
          "attribute": true
        }
      },
      "required": [ "label" ],
      "additionalProperties": false
    },
    "constant": {
      "description": "Node to hold a single value",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "attribute": true
        },
        "value": {
          "type": "string",
          "attribute": true
        }
      },
      "required": [ "name", "value" ],
      "additionalProperties": false
    },
    "constant1d": {
      "description": "constant1d",
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "attribute": true
        },
        "domainMin": {
          "type": "number",
          "attribute": true
        },
        "domainMax": {
          "type": "number",
          "attribute": true
        },
        "constant": {
          "type": "number",
          "attribute": true
        },
        "axes": { "$ref": "#/definitions/axes" }
      },
      "additionalProperties": true
    },
    "crossSection": {
      "description": "Cross section data as a function of energy",
      "type": "array",
      "items": {
        "anyOf": [
          { "$ref": "#/definitions/XYs1d" },
          { "$ref": "#/definitions/regions1d" },
          { "$ref": "#/definitions/resonanceRegionLink" },
          { "$ref": "#/definitions/documentation" }
        ]
      },
      "minItems": 1
    },
    "distribution": {
      "description": "Array of Secondary energy-angle distributions",
      "type": "array",
      "items": {
        "anyOf": [
          { "$ref": "#/definitions/angularEnergy" },
          { "$ref": "#/definitions/KalbachMann" },
          { "$ref": "#/definitions/phaseSpace" },
          { "$ref": "#/definitions/twoBody" },
          { "$ref": "#/definitions/uncorrelated" },
          { "$ref": "#/definitions/unspecified" }
        ],
        "minItems": 1
      }
    },
    "documentation": {
      "description": "Documentation node",
      "type": "object"
    },
    "energyAngular": {
      "description":"Tabulated energy-angular distribution",
      "type": "object"
    },
    "functional": {
      "description": "Functional node (container).",
      "type": "object",
      "properties": {
        "value": {
          "type": "number",
          "attribute": true
        },
        "valueType": {
          "type": "string",
          "enum": [ "Float64", "Integer64", "Integer32", "UInteger32", "Fraction32" ],
          "default": "Float64",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        }
      }
    },
    "grid": {
      "description": "grid axis",
      "type": "object",
      "properties": {
        "interpolation": {
          "type": "string",
          "attribute": true
        },
        "style": {
          "type": "string",
          "enum": [ "none", "points", "boundaries", "parameters" ],
          "default": "none",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        },
        "unit": {
          "type": "string",
          "attribute": true
        },
        "grid": { "$ref": "#/definitions/values" }
      },
      "required": [ "label", "grid" ],
      "additionalProperties": false
    },
    "KalbachMann": {
      "description": "Secondary distribution described by Kalbach-Mann systematics",
      "type": "object"
    },
    "Legendre": {
      "description": "Legendre expansion",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties":{
            "value": {},
            "valueType": {},
            "label": {},
            "lowerIndex": {
              "type": "integer",
              "default": 0
            },
            "domainMin": {
              "type": "number",
              "attribute": true
            },
            "domainMax": {
              "type": "number",
              "attribute": true
            },
            "coefficients": { "$ref": "#/definitions/values" }
          },
          "required": [ "coefficients" ],
          "additionalProperties": false
        }
      ]
    },
    "multiplicity": {
      "description": "How many of a product are emitted in a reaction",
      "type": "object",
      "oneOf": [
        {
          "properties":{
            "XYs1d": { "$ref": "#/definitions/XYs1d" }
          },
          "required": [ "XYs1d" ],
          "additionalProperties": false
        },
        {
          "properties":{
            "constant": { "$ref": "#/definitions/constant1d" }
          },
          "required": [ "constant" ],
          "additionalProperties": false
        },
        {
          "properties":{
            "polynomial1d": { "$ref": "#/definitions/polynomial1d" }
          },
          "required": [ "polynomial1d" ],
          "additionalProperties": false
        },
        { 
          "properties":{
            "reference": { "$ref": "#/definitions/reference" }
          },
          "required": [ "reference" ],
          "additionalProperties": false
        },
        {
          "properties":{
            "regions1d": { "$ref": "#/definitions/regions1d" }
          },
          "required": [ "regions1d" ],
          "additionalProperties": false
        }
      ]
    },
    "outputChannel": {
      "description": "Secondary information for a reaction",
      "type": "object",
      "properties": {
        "genre": {
          "type": "string",
          "enum": [ "twoBody", "NBody" ],
          "attribute": true
        },
        "Q": { "$ref": "#/definitions/Q" },
        "products": { "$ref": "#/definitions/products" }
      },
      "additionalProperties": false
    },
    "phaseSpace": {
      "description": "N-body phase space secondary distribution",
      "type": "object"
    },
    "polynomial1d": {
      "description": "1-dimensional polynomial expansion",
      "type": "object"
    },
    "product": {
      "description": "Secondary product from a reaction",
      "type": "object",
      "properties": {
        "pid": {
          "type": "string",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        },
        "documentation": { "$ref": "#/definitions/documentation" },
        "distribution": { "$ref": "#/definitions/distribution" },
        "outputChannel": { "$ref": "#/definitions/outputChannel" },
        "multiplicity": { "$ref": "#/definitions/multiplicity" }
      },
      "required": [ "pid", "label", "multiplicity", "distribution" ],
      "additionalProperties": false
    },
    "products": {
      "description": "An array of secondary products from a reaction",
      "type": "object",
      "properties": {
        "Q": { "$ref": "#/definitions/constant" },
        "kinematicType": {
          "type": "string",
          "enum": [ "two-body", "uncorrelated", "correlated", "fission" ],
          "default": "two-body",
          "attribute": true
        },
        "products":{
          "type": "array",
          "items": { "$ref": "#/definitions/product" },
          "minItems": 1
        },
        "documentation": { "$ref": "#/definitions/documentation" }
      },
      "required": [ "products" ],
      "additionalProperties": false
    },
    "Q": {
      "description": "Q-value",
      "type": "object",
      "properties": {
        "constant": { "$ref": "#/definitions/constant1d" }
      },
      "required": [ "constant" ],
      "additionalProperties": false
    },
    "reaction": {
      "description": "A single reaction",
      "type": "object",
      "properties": {
        "ENDF_MT": {
          "type": "integer",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        },
        "fissionGenre": {
          "type": "string",
          "attribute": true
        },
        "crossSection": { "$ref": "#/definitions/crossSection" },
        "outputChannel": { "$ref": "#/definitions/outputChannel" }
      },
      "required": [ "label", "ENDF_MT", "crossSection", "outputChannel" ],
      "additionalProperties": false
    },
    "reactions": {
      "description": "Array of all reactions",
      "type": "object",
      "properties": {
        "documentation": { "$ref": "#/definitions/documentation" },
        "reactions": {
          "type": "array",
          "items": { "$ref": "#/definitions/reaction" },
          "minItems": 1
        }
      },
      "required": [ "reactions" ],
      "additionalProperties": false
    },
    "reactionSuite": {
      "description": "All reactions involving the same combindation of projectile and target",
      "type": "object",
      "properties": {
        "projectile": {
          "description": "Projectile particle id.",
          "type": "string",
          "attribute": true
        },
        "target": {
          "description": "Target particle id.",
          "type": "string",
          "attribute": true
        },
        "evaluation": {
          "description": "Name of the evaluation, e.g. ‘ENDF-VIII’",
          "type": "string",
          "attribute": true
        },
        "format": {
          "description": "GNDS format version, e.g. ‘2.1’",
          "type": "string",
          "attribute": true
        },
        "projectileFrame": {
          "type": "string",
          "enum": [ "lab", "centerOfMass" ],
          "attribute": true
        },
        "reactions": { "$ref": "#/definitions/reactions" }
      },
      "required": [ "projectile", "target", "evaluation", "format", "projectileFrame" ],
      "additionalProperties": false
    },
    "recoil": {
      "description": "recoil node",
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "attribute": true
        }
      },
      "required": [ "href" ],
      "additionalProperties": false
    },
    "reference": {
      "description": "reference",
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "attribute": true
        },
        "label": {
          "type": "string", 
          "attribute": true
        }
      },
      "required": [ "href" ],
      "additionalProperties" : false
    },
    "resonanceRegionLink": {
      "description": "Used to establish a link from cross section to an element in the resonance region.",
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "attribute": true
        },
        "emin": {
          "type": "string",
          "attribute": true
        },
        "emax": {
          "type": "string",
          "attribute": true
        },
        "representation": {
          "type": "string", 
          "attribute": true
        }
      },
      "required": [ "href" ],
      "additionalProperties" : false
    },
    "regions1d": {
      "description": "An array of XYs1d data, with some other metadata",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties": {
            "value": {},
            "valueType": {},
            "label": {},
            "XYs1d": { 
              "type": "array",
              "items": { "$ref": "#/definitions/XYs1d" }
            },
            "axes": { "$ref": "#/definitions/axes" },
            "uncertainties": { "$ref": "#/definitions/uncertainties" },
            "uncertainty": { "$ref": "#/definitions/uncertainty" }
          },
          "additionalProperties": false,
          "requiredProperties": "XYs1d",
          "dependencies": {
            "uncertainties": { "not": { "required": [ "uncertainty" ] } },
            "uncertainty": { "not": { "required": [ "uncertainties" ] } }
          }
        }
      ]
    },
    "text": {
      "description": "Store a sequence of characters",
      "type": "object",
      "properties": {
        "encoding": {
          "type": "string",
          "enum": [ "ascii", "utf8" ],
          "default": "ascii",
          "atrribute": true
        },
        "markup": {
          "type": "string",
          "enum": [ "none", "xml", "xhtml", "latex" ],
          "default": "none",
          "attribute": true
        },
        "text": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "twoBody": {
      "description": "Energy-angle distribution described by two-body kinematics",
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "attribute": true
        },
        "productFrame": {
          "type": "string",
          "enum": [ "lab", "centerOfMass" ],
          "attribute": true
        },
        "XYs2d": { "$ref": "#/definitions/XYs2d" },
        "recoil": { "$ref": "#/definitions/recoil" }
      },
      "additionalProperties": false
    },
    "uncertainties": {
      "description": "Array of uncertainty data",
      "type": "array",
      "items": { "$ref": "#/definitions/uncertainty" },
      "minItems": 1
    },
    "uncertainty": {
      "description": "Uncertainty data",
      "type": "object",
      "properties": {
        "style": {
          "type": "string",
          "attribute": true
        },
        "type": {
          "type": "string",
          "enum": [ "variance", "variance+", "variance-", "covariance", 
            "confidence-interval" ],
            "default": "variance",
            "attribute": true
        },
        "pdf": {
          "oneOf": [
            {
              "type": "string",
              "enum": [ "normal", "log-normal" ],
              "default": "normal"
            },
            {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          ],
          "attribute": true
        },
        "relation": {
          "type": "string",
          "enum": [ "absolute", "offset", "relative", "percent" ],
          "default": "absolute",
          "attribute": true
        },
        "uncertainty": {
          "oneOf": [
            { "$ref": "#/definitions/XYs1d" }
          ]
        }
      },
      "required": [ "uncertainty" ],
      "additionalProperties": false
    },
    "uncorrelated": {
      "description": "Uncorrelated energy and angle secondary distribution",
      "type": "object"
    },
    "unspecified": {
      "description": "Unspecified secondary distribution",
      "type": "object",
      "properties": {
        "style": {
          "type": "string",
          "attribute": true
        },
        "productFrame": {
          "type": "string",
          "enum": [ "lab", "centerOfMass" ],
          "attribute": true
        }
      },
      "additionalProperties": false
    },
    "urrProbabilityTable": {
      "type": "object"
    },
    "values": {
      "id": "#values",
      "description": "Store a sequence of numerical values",
      "type": "object",
      "properties": {
        "valueType":{
          "type": "string",
          "enum": [ "Float64", "Integer64", "Integer32", "UInteger32", "Fraction32" ],
          "default": "Float64",
          "attribute": true
        },
        "start": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "atrribute": true
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "atrribute": true
        },
        "values":{
          "type": "array",
          "items": { "type": "number" }
        }
      },
      "required": [ "values" ],
      "additionalProperties": false
    },
    "XYs1d": {
      "description": "A tabulated uni-variate functional",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties":{
            "interpolation": {
              "type": "string",
              "enum": [ "lin-lin", "lin-log", "log-log", "flat" ],
              "default": "lin-lin",
              "attribute": true
            },
            "value": {},
            "valueType": {},
            "label": {},
            "pairs": { "$ref": "#/definitions/values" },
            "axes": { "$ref": "#/definitions/axes" },
            "uncertainties": { "$ref": "#/definitions/uncertainties" },
            "uncertainty": { "$ref": "#/definitions/uncertainty" }
          },
          "required": [ "pairs" ],
          "additionalProperties": false,
          "dependencies": {
            "uncertainties": { "not": { "required": [ "uncertainty" ] } },
            "uncertainty": { "not": { "required": [ "uncertainties" ] } }
          }
        }
      ]
    },
    "XYs2d": {
      "description": "A multi-variate functional",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties":{
            "interpolation": {
              "type": "string",
              "enum": [ "lin-lin", "lin-log", "log-log", "flat" ],
              "default": "lin-lin",
              "attribute": true
            },
            "value": {},
            "valueType": {},
            "label": {},
            "function": { 
              "type": "array",
              "items": {
                "anyOf": [
                  { "$ref": "#/definitions/Legendre" },
                  { "$ref": "#/definitions/XYs1d" },
                  { "$ref": "#/definitions/axes" },
                  { "$ref": "#/definitions/regions1d" },
                  { "$ref": "#/definitions/uncertainty" },
                  { "$ref": "#/definitions/uncertainties" }
                ]
              },
              "minItems": 1
            }
          },
          "required": [ "function" ],
          "additionalProperties": false
        }
      ]
    }
  }
}
