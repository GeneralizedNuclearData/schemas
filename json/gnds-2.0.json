{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http:/github.com/generalizednucleardata/schemas/blob/master/json/gnds-2.0.json",
  "type": "object",
  "version": 2.0,
  "title": "GNDS JSON schema",
  "description": "Schema for a GNDS JSON object",
  "properties":{
    "constant": {"$ref": "#/definitions/constant" },
    "crossSection": {"$ref": "#/definitions/crossSection" },
    "distributions": {"$ref": "#/definitions/distributions" },
    "documentation": {"$ref": "#/definitions/documentation" },
    "multiplicity": {"$ref": "#/definitions/multiplicity" },
    "products": {"$ref": "#/definitions/products" },
    "reaction": {"$ref": "#/definitions/reaction" },
    "regions1d": {"$ref": "#/definitions/regions1d" },
    "resonanceRegionLink": {"$ref": "#/definitions/resonanceRegionLink" },
    "XYs1d": {"$ref": "#/definitions/XYs1d" },
    "uncertainties": {"$ref": "#/definitions/uncertainties" }
  },
  "definitions": {
    "axes": {
      "description": "Mechanism for providing label an unit for every axis.",
      "type": "array",
      "oneOf": [
        {
          "items": { "$ref": "#/definitions/axis" }
        },
        {
          "items": { "$ref": "#/definitions/grid" }
        }
      ],
      "minItems": 2
    },
    "axis": {
      "description": "label and unit for each axis",
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "attribute": true
        },
        "unit": {
          "type": "string",
          "attribute": true
        }
      },
      "required": [ "label" ],
      "additionalProperties": false
    },
    "constant": {
      "description": "Node to hold a single value",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "attribute": true
        },
        "value": {
          "type": "string",
          "attribute": true
        }
      },
      "required": [ "name", "value" ],
      "additionalProperties": false
    },
    "constant1d": {
      "description": "constant1d",
      "type": "object"
    },
    "crossSection": {
      "description": "Cross section data as a function of energy",
      "type": "array",
      "items": {
        "anyOf": [
          { "$ref": "#definitions/XYs1d" },
          { "$ref": "#definitions/regions1d" },
          { "$ref": "#definitions/resonanceRegionLink" },
          { "$ref": "#/definitions/documentation" }
        ]
      }
    },
    "distributions": {
      "description": "Array of distributions",
      "type": "array",
      "items": { "$ref": "#/definitions/distribution" }
      "minItems": 1
    },
    "distribution": {
      "description": "Secondary energy-angle distributions"
      "type": "array",
      "items": {
        "anyOf": [
        ]
      }
    },
    "documentation": {
      "description": "Documentation node",
      "type": "object"
    },
    "functional": {
      "description": "Functional node (container).",
      "type": "object",
      "properties": {
        "value": {
          "type": "number",
          "attribute": true
        },
        "valueType": {
          "type": "string",
          "enum": [ "Float64", "Integer64", "Integer32", "UInteger32", "Fraction32" ],
          "default": "Float64",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        }
      }
    },
    "grid": {
      "description": "grid axis",
      "type": "object",
      "properties": {
        "interpolation": {
          "type": "string",
          "attribute": true
        },
        "style": {
          "type": "string",
          "enum": [ "none", "points", "boundaries", "parameters" ],
          "default": "none",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        },
        "unit": {
          "type": "string",
          "attribute": true
        },
        "grid": { "$ref": "#/definitions/values" }
      },
      "required": [ "label", "grid" ],
      "additionalProperties": false
    },
    "multiplicity": {
      "description": "How many of a product are emitted in a reaction",
      "type": "object",
      "oneOf": [
        {
          "properties":{
            "XYs1d": { "$ref": "#/definitions/XYs1d" }
          },
          "required": [ "XYs1d" ]
        },
        {
          "properties":{
            "constant": { "$ref": "#/definitions/constant" }
          },
          "required": [ "constant" ]
        },
        {
          "properties":{
            "polynomial1d": { "$ref": "#/definitions/polynomial1d" }
          },
          "required": [ "polynomial1d" ]
        },
        { 
          "properties":{
            "reference": { "$ref": "#/definitions/reference" }
          },
          "required": [ "reference" ]
        },
        {
          "properties":{
            "regions1d": { "$ref": "#/definitions/regions1d" }
          },
          "required": [ "regions1d" ]
        }
      ]
    },
    "outputChannel": {
      "description": "Secondary information for a reaction",
      "type": "object",
      "properties": {
        "genre": {
          "type": "string",
          "enum": [ "twoBody", "NBody" ],
          "attribute": true
        },
        "Q": { "$ref": "#/definitions/Q" },
        "products": { "$ref": "#/definitions/products" }
      },
      "additionalProperties": false
    },
    "polynomial1d": {
      "description": "1-dimensional polynomial expansion",
      "type": "object"
    },
    "product": {
      "description": "Secondary product from a reaction",
      "type": "object",
      "properties": {
        "pid": {
          "type": "string",
          "attribute": true
        },
        "label": {
          "type": "string",
          "attribute": true
        },
        "documentation": { "$ref": "#/definitions/documentation" },
        "distributions": { "$ref": "#/definitions/distributions" },
        "outputChannel": { "$ref": "#/definitions/outputChannel" },
        "multiplicity": { "$ref": "#/definitions/multiplicity" }
      },
      "required": [ "pid", "label", "multiplicity", "distributions" ],
      "additionalProperties": false
    },
    "products": {
      "description": "An array of secondary products from a reaction",
      "type": "object",
      "properties": {
        "Q": { "$ref": "#/definitions/constant" },
        "kinematicType": {
          "type": "string",
          "enum": [ "two-body", "uncorrelated", "correlated", "fission" ],
          "default": "two-body",
          "attribute": true
        },
        "products":{
          "type": "array",
          "items": { "$ref": "#/definitions/product" },
          "minItems": 1
        },
        "documentation": { "$ref": "#/definitions/documentation" }
      },
      "required": [ "products" ],
      "additionalProperties": false
    },
    "reaction": {
      "description": "A single reaction",
      "type": "object",
      "allOf": [
        {
          "properties": {
            "ENDF_MT": {
              "type": "integer",
              "attribute": true
            },
            "label": {
              "type": "string",
              "attribute": true
            },
            "fissionGenre": {
              "type": "string",
              "attribute": true
            }
          },
          "required": [ "label", "ENDF_MT" ]
        },
        { "$ref": "#/definitions/crossSection" },
        { "$ref": "#/definitions/outputChannel" }
      ]
    },
    "reactions": {
      "description": "Array of all reactions",
      "type": "object",
      "properties": {
        "documentation": { "$ref": "#/definitions/documentation" },
        "reactions": {
          "type": "array",
          "items": { "$ref": "#/definitions/reaction" },
          "minItems": 1
        }
      },
      "required": [ "reactions" ],
      "additionalProperties": false
    },
    "reference": {
      "description": "reference",
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "attribute": true
        },
        "label": {
          "type": "string", 
          "attribute": true
        }
      },
      "required": [ "href" ],
      "additionalProperties" : false
    },
    "resonanceRegionLink": {
      "description": "Used to establish a link from cross section to an element in the resonance region.",
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "attribute": true
        },
        "emin": {
          "type": "string",
          "attribute": true
        },
        "emax": {
          "type": "string",
          "attribute": true
        },
        "representation": {
          "type": "string", 
          "attribute": true
        }
      },
      "required": [ "href" ],
      "additionalProperties" : false
    },
    "regions1d": {
      "description": "A region",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties": {
            "XYs1d": { "$ref": "#/definitions/XYs1d" },
            "axes": { "$ref": "#/definitions/axes" },
            "uncertainties": { "$ref": "#/definitions/uncertainties" },
            "uncertainty": { "$ref": "#/definitions/uncertainty" }
          },
          "dependencies": {
            "uncertainties": { "not": { "required": [ "uncertainty" ] } },
            "uncertainty": { "not": { "required": [ "uncertainties" ] } }
          }
        }
      ]
    },
    "text": {
      "description": "Store a sequence of characters",
      "type": "object",
      "properties": {
        "encoding": {
          "type": "string",
          "enum": [ "ascii", "utf8" ],
          "default": "ascii",
          "atrribute": true
        },
        "markup": {
          "type": "string",
          "enum": [ "none", "xml", "xhtml", "latex" ],
          "default": "none",
          "attribute": true
        },
        "text": {
          "type": "string"
        }
      }
    },
    "uncertainties": {
      "description": "Array of uncertainty data",
      "type": "array",
      "items": { "$ref": "#/definitions/uncertainty" },
      "minItems": 1
    },
    "uncertainty": {
      "description": "Uncertainty data",
      "type": "object",
      "properties": {
        "style": {
          "type": "string",
          "attribute": true
        },
        "type": {
          "type": "string",
          "enum": [ "variance", "variance+", "variance-", "covariance", 
            "confidence-interval" ],
            "default": "variance",
            "attribute": true
        },
        "pdf": {
          "oneOf": [
            {
              "type": "string",
              "enum": [ "normal", "log-normal" ],
              "default": "normal"
            },
            {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          ],
          "attribute": true
        },
        "relation": {
          "type": "string",
          "enum": [ "absolute", "offset", "relative", "percent" ],
          "default": "absolute",
          "attribute": true
        },
        "uncertainty": {
          "oneOf": [
            { "$ref": "#/definitions/XYs1d" }
          ]
        }
      },
      "required": [ "uncertainty" ],
      "additionalProperties": false
    },
    "urrProbabilityTable": {
      "type": "object"
    },
    "values": {
      "description": "Store a sequence of numerical values",
      "type": "object",
      "properties": {
        "valueType":{
          "type": "string",
          "enum": [ "Float64", "Integer64", "Integer32", "UInteger32", "Fraction32" ],
          "default": "Float64",
          "attribute": true
        },
        "start": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "atrribute": true
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "atrribute": true
        },
        "values":{
          "type": "array",
          "items": { "type": "integer" }
        }
      },
      "required": [ "values" ],
      "additionalProperties": false
    },
    "XYs1d": {
      "description": "A tabulated uni-variate functional",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/functional" },
        {
          "properties":{
            "interpolation": {
              "type": "string",
              "enum": [ "lin-lin", "lin-log", "log-log", "flat" ],
              "default": "lin-lin",
              "attribute": true
            },
            "pairs": { "$ref": "#/definitions/values" },
            "axes": { "$ref": "#/definitions/axes" },
            "uncertainties": { "$ref": "#/definitions/uncertainties" },
            "uncertainty": { "$ref": "#/definitions/uncertainty" }
          },
          "required": [ "pairs" ],
          "dependencies": {
            "uncertainties": { "not": { "required": [ "uncertainty" ] } },
            "uncertainty": { "not": { "required": [ "uncertainties" ] } }
          }
        }
      ]
    }
  }
}
